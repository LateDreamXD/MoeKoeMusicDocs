# RPC地址设置

本功能用于在应用内自定义后端 RPC服务地址，用来覆盖默认的 `VITE_APP_API_URL`（通常为本地服务 `http://127.0.0.1:6521`）。适用于你将 API 部署在远程服务器、使用反向代理、或需要切换到不同环境的场景。

## 使用方式

路径：`设置` → `系统` → `RPC地址`

- `默认`：使用内置默认地址（通常来自 `VITE_APP_API_URL`）。
- `自定义`：填写完整的 `http://` 或 `https://` 地址（必须包含协议头）。

保存后会提示“刷新后生效”，需要刷新/重启应用使新地址生效。

## 测试按钮

“测试连接”会请求 `GET /register/dev` 来验证该地址是否可用且符合 MoeKoe Music API 的调用协议。如果测试失败，请优先检查地址是否正确、是否带了正确的反代路径，以及服务是否在运行。

## 切换后可能带来的问题

切换 RPC地址会影响应用所有与后端交互的功能，可能导致以下问题：

- 无法登录 / 掉登录：不同服务实例的 Cookie、会话策略可能不同。
- 部分功能不可用：例如搜索、歌单、歌词等接口在某些部署中可能被禁用或配置不同。
- 访问慢或超时：远程网络延迟、跨境网络、服务器性能都会直接影响体验。
- HTTPS/HTTP 混用问题：在 HTTPS 环境下访问 HTTP 资源可能被浏览器拦截（Mixed Content）。
- CORS/跨域问题：如果你的 API 通过反代/域名访问，需要正确配置跨域与 `Access-Control-Allow-Credentials` 等响应头。
- 反代路径不匹配：例如实际服务挂在 `/api`，但你填写了根地址，导致请求路径错误（404）。

## RPC版本兼容问题

不同版本（或不同分支/第三方改版）的 API 服务在接口路径、参数、加密/签名、返回结构上可能存在差异。常见表现包括：

- 某些页面能打开但功能报错：接口能通，但字段缺失/结构变化导致解析失败。
- 部分接口返回“协议不符合/参数错误”：服务端版本较旧或实现不同，无法识别客户端发起的请求。
- 登录或设备注册失败：鉴权方式、Cookie 策略或注册流程在不同版本之间可能不一致。

如果遇到这类问题，建议切回 `默认`，或升级/更换为与当前客户端版本匹配的 API 服务版本。
